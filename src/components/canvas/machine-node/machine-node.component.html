<div
  class="absolute w-36 h-32 rounded-xl border-2 shadow-md
         hover:border-primary/50 hover:shadow-lg transition-all
         cursor-grab select-none"
  [class.border-slate-200]="machine.status === 'idle'"
  [class.border-blue-400]="machine.status === 'processing'"
  [class.border-yellow-400]="machine.status === 'FLASHING'"
  [class.animate-pulse]="machine.status === 'FLASHING'"
  [style.left.px]="machine.x"
  [style.top.px]="machine.y"
  [style.background-color]="getMachineColor() + '20'"

  appDraggable
  appSelectable
  (dragEnd)="onDragEnd($event)"
>

  <!-- HEADER -->
  <div
    class="h-8 rounded-t-[10px] border-b
           flex items-center justify-between px-3 transition-all"
    [style.background-color]="getMachineColor() + '30'"
    [style.border-color]="getMachineColor() + '40'">
    <span class="text-xs font-bold tracking-wider transition-colors"
          [style.color]="getMachineColor()">
      {{ machine.name }}
    </span>
    <div
      class="w-2 h-2 rounded-full transition-all"
      [ngClass]="getStatusColor()">
    </div>
  </div>

  <!-- BODY -->
  <div class="flex-1 flex flex-col items-center justify-center p-2">

    <!-- MACHINE ICON -->
    <div class="mb-2"
         [class.animate-bounce]="machine.status === 'FLASHING'">
      <svg
        class="w-10 h-10 transition-colors duration-300"
        [style.color]="getMachineColor()"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24">
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z">
        </path>
      </svg>
    </div>

    <!-- STATUS TEXT -->
    <span
      class="text-[10px] font-semibold uppercase tracking-wide transition-colors"
      [ngClass]="{
        'text-green-600': machine.status === 'idle',
        'text-blue-600': machine.status === 'processing',
        'text-yellow-600 animate-pulse': machine.status === 'FLASHING'
      }">
      {{ getStatusText() }}
    </span>

    <!-- SERVICE TIME -->
    <span class="text-[9px] text-slate-400 mt-1">
      {{ getServiceTimeSeconds() }}s
    </span>

    <!-- CURRENT PRODUCT INDICATOR -->
    <span
      *ngIf="machine.status === 'processing'"
      class="text-[9px] text-slate-500 mt-0.5 font-medium">
      ðŸ”§ Processing
    </span>

    <!-- COMPLETION INDICATOR -->
    <span
      *ngIf="machine.status === 'FLASHING'"
      class="text-[9px] text-yellow-600 mt-0.5 font-medium animate-pulse">
      âœ¨ Complete!
    </span>
  </div>

  <!-- INPUT CONNECTOR (LEFT) -->
  <div
    class="absolute top-1/2 -left-1.5 w-3 h-3 bg-white
           border-2 rounded-full -translate-y-1/2 transition-colors"
    [class.border-green-400]="machine.inputQueue"
    [class.border-slate-300]="!machine.inputQueue">
  </div>

  <!-- OUTPUT CONNECTOR (RIGHT) -->
  <div
    class="absolute top-1/2 -right-1.5 w-3 h-3 bg-white
           border-2 rounded-full -translate-y-1/2 transition-colors"
    [class.border-green-400]="machine.outputQueue"
    [class.border-slate-300]="!machine.outputQueue">
  </div>

</div>
